<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conte√∫dos e Dom√≠nio</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

  <style>
    /* --- CSS GERAL (Identico aos outros) --- */
    :root { --primary-color: #4a6fa5; --secondary-color: #166088; --accent-color: #4fc3f7; --success-color: #4caf50; --warning-color: #ff9800; --danger-color: #f44336; --bg-color: #f5f7fa; --border-radius: 12px; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background-color: var(--bg-color); color: #333; display: flex; min-height: 100vh; overflow-x: hidden; }
    
    /* Sidebar */
    #sidebar { width: 250px; background: linear-gradient(135deg, #2c3e50, #4a6fa5); color: white; padding: 30px 20px; position: fixed; height: 100%; z-index: 1000; top: 0; left: 0; transition: transform 0.3s; }
    #sidebar .logo { text-align: center; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
    #sidebar .logo h2 { color: white; font-weight: 500; }
    #sidebar .logo i { font-size: 2rem; margin-bottom: 10px; color: var(--accent-color); }
    .sidebar-menu { list-style: none; padding: 0; }
    .sidebar-button { display: flex; align-items: center; padding: 12px 15px; border-radius: 12px; color: white; text-decoration: none; margin-bottom: 10px; transition: 0.3s; }
    .sidebar-button:hover { background: rgba(255,255,255,0.1); transform: translateX(5px); }
    .sidebar-button.active { background-color: var(--accent-color); color: #343a40; font-weight: 500; }
    .sidebar-button i { margin-right: 10px; width: 20px; text-align: center; }
    
    /* Mobile Btn */
    .mobile-menu-btn { display: none; position: fixed; top: 15px; left: 15px; z-index: 1100; background: var(--primary-color); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 1.2rem; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    #sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 900; }
    #sidebar-overlay.show { display: block; }

    /* Content */
    #main-content { flex: 1; margin-left: 250px; padding: 30px; max-width: 1400px; width: calc(100% - 250px); margin-right: auto; transition: margin-left 0.3s ease, width 0.3s ease; }
    .header { margin-bottom: 30px; }
    .header h1 { color: var(--primary-color); font-weight: 500; }

    /* --- √ÅREA DE CONTE√öDOS --- */
    .subject-section { margin-bottom: 40px; }
    .subject-title { font-size: 1.4rem; color: var(--secondary-color); margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
    
    .topics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .topic-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      transition: transform 0.2s;
    }
    .topic-card:hover { transform: translateY(-3px); }

    .topic-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .topic-name { font-weight: bold; color: #333; font-size: 1rem; }
    .topic-stats { font-size: 0.8rem; color: #666; }

    /* Barra de Progresso (Domin√¢ncia) */
    .mastery-container {
      background: #eee;
      border-radius: 6px;
      height: 8px;
      width: 100%;
      overflow: hidden;
      margin-top: 10px;
    }
    .mastery-bar {
      height: 100%;
      width: 0%;
      transition: width 1s ease;
      background: #ccc;
    }
    
    /* Cores de Domin√¢ncia */
    .level-high { background: var(--success-color); }
    .level-mid { background: var(--warning-color); }
    .level-low { background: var(--danger-color); }
    .level-none { background: #ccc; }

    .mastery-label {
      font-size: 0.75rem;
      margin-top: 5px;
      text-align: right;
      font-weight: bold;
    }
    .label-high { color: var(--success-color); }
    .label-mid { color: var(--warning-color); }
    .label-low { color: var(--danger-color); }
    .label-none { color: #999; }

    #loading { text-align: center; margin-top: 50px; color: #666; }

    @media (max-width: 900px) {
      #sidebar { transform: translateX(-100%); width: 260px; }
      #sidebar.open { transform: translateX(0); box-shadow: 5px 0 15px rgba(0,0,0,0.3); }
      .mobile-menu-btn { display: block; }
      #main-content { margin-left: 0; width: 100%; padding: 15px; padding-top: 70px; }
    }
  </style>
</head>
<body>

<button class="mobile-menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
<div id="sidebar-overlay" onclick="toggleSidebar()"></div>

<div id="sidebar">
  <div class="logo"><i class="fas fa-book-open"></i><h2>Med F√°cil</h2></div>
  <ul class="sidebar-menu">
    <li><a href="index.html" class="sidebar-button"><i class="fas fa-home"></i><span>In√≠cio</span></a></li>
    <li><a href="historico.html" class="sidebar-button"><i class="fas fa-history"></i><span>Hist√≥rico</span></a></li>
    <li><a href="#" class="sidebar-button active"><i class="fas fa-book"></i><span>Conte√∫dos</span></a></li>
    <li><a href="revisoes.html" class="sidebar-button"><i class="fas fa-sync-alt"></i><span>Revis√µes</span></a></li>
    <li><a id="btnLogout" href="#" class="sidebar-button"><i class="fas fa-sign-out-alt"></i><span>Sair</span></a></li>
  </ul>
</div>

<div id="main-content">
  <div class="header">
    <h1>Dom√≠nio de Conte√∫do</h1>
    <p style="color:#666;">Visualize sua taxa de acerto por tema.</p>
  </div>

  <div id="loading"><i class="fas fa-spinner fa-spin fa-2x"></i></div>
  <div id="contentContainer"></div>
</div>

<script>
  function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('open');
    document.getElementById('sidebar-overlay').classList.toggle('show');
  }

  const firebaseConfig = {
    apiKey: "AIzaSyCWNFjeLIjBgDa5v3W5vsCdJ1PGDeHE35A",
    authDomain: "meu-study-tracker.firebaseapp.com",
    databaseURL: "https://meu-study-tracker-default-rtdb.firebaseio.com",
    projectId: "meu-study-tracker",
    storageBucket: "meu-study-tracker.firebasestorage.app",
    messagingSenderId: "715609213126",
    appId: "1:715609213126:web:3e9cbe7e840ea20a1b6fc7"
  };

  let database, auth;
  try {
    const app = firebase.initializeApp(firebaseConfig);
    database = firebase.database();
    auth = firebase.auth(); 
  } catch (error) { console.error(error); }

  // --- LISTA DE TEMAS (ATUALIZADA COM ELETROCARDIOGRAMA) ---
  const dadosTemas = {
    "Cirurgia Geral": ["Anestesia", "Apendicite aguda", "Choque", "Cicatriza√ß√£o", "Cirurgia vascular", "Cistite aguda", "H√©rnias", "Pancreatite aguda", "Queimaduras", "Trauma abdominal", "Trauma tor√°cico"],
    "Cl√≠nica M√©dica": ["Asma", "COVID-19", "Cefaleias", "Dengue", "Diabetes", "HAS", "HIV", "IAM", "ICC", "Pneumonia", "Sepse", "Tuberculose", "Eletrocardiograma"],
    "Ginecologia e Obstetr√≠cia": ["Abortamento", "Pr√©-natal", "C√¢ncer de colo uterino", "C√¢ncer de mama", "Diabetes gestacional", "DHEG", "Parto", "Vulvovaginites"],
    "Pediatria": ["Aleitamento", "Asma", "Bronquiolite", "Cardiopatias", "Desenvolvimento", "Imuniza√ß√£o", "Pneumonias", "Puericultura"],
    "Medicina Preventiva": ["Epidemiologia", "SUS", "√âtica m√©dica", "Vigil√¢ncia epidemiol√≥gica"]
  };

  window.addEventListener('load', () => {
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        document.getElementById('btnLogout').addEventListener('click', (e)=>{e.preventDefault(); auth.signOut().then(()=>window.location.href='login.html');});
        loadMasteryData(user.uid);
      } else {
        window.location.href = 'login.html';
      }
    });
  });

  async function loadMasteryData(uid) {
    try {
      const snap = await database.ref('users/' + uid + '/sessionsByDate').get();
      const sessions = snap.exists() ? snap.val() : {};
      
      calculateAndRender(sessions);
      document.getElementById('loading').style.display = 'none';
    } catch (e) { console.error(e); }
  }

  function calculateAndRender(sessions) {
    // 1. Processar dados do Firebase para criar um mapa de performance
    const stats = {}; // { "Asma": { correct: 10, total: 12 }, ... }

    for (const date in sessions) {
      sessions[date].forEach(s => {
        const topic = s.topic || "Geral";
        if(topic === "Geral") return;

        if (!stats[topic]) stats[topic] = { correct: 0, total: 0 };
        stats[topic].correct += (s.exercisesCorrect || 0);
        stats[topic].total += (s.exercisesDone || 0);
      });
    }

    const container = document.getElementById('contentContainer');
    container.innerHTML = '';

    // 2. Iterar sobre a lista fixa de temas (dadosTemas)
    for (const [categoria, temas] of Object.entries(dadosTemas)) {
      
      // Cria se√ß√£o da Categoria
      const section = document.createElement('div');
      section.className = 'subject-section';
      section.innerHTML = `<h2 class="subject-title">${categoria}</h2>`;
      
      const grid = document.createElement('div');
      grid.className = 'topics-grid';

      temas.forEach(tema => {
        // Pega dados ou zero se n√£o estudou
        const data = stats[tema] || { correct: 0, total: 0 };
        const accuracy = data.total > 0 ? (data.correct / data.total * 100) : 0;
        
        // Define Cor e Texto
        let barClass = 'level-none';
        let labelClass = 'label-none';
        let labelText = 'N√£o iniciado';

        if (data.total > 0) {
          if (accuracy >= 80) {
            barClass = 'level-high'; labelClass = 'label-high'; labelText = 'Dominado üöÄ';
          } else if (accuracy >= 50) {
            barClass = 'level-mid'; labelClass = 'label-mid'; labelText = 'Em progresso ‚ö†Ô∏è';
          } else {
            barClass = 'level-low'; labelClass = 'label-low'; labelText = 'Aten√ß√£o üö®';
          }
        }

        const card = document.createElement('div');
        card.className = 'topic-card';
        card.innerHTML = `
          <div class="topic-header">
            <span class="topic-name">${tema}</span>
            <span class="topic-stats">${data.correct}/${data.total}</span>
          </div>
          <div class="mastery-container">
            <div class="mastery-bar ${barClass}" style="width: ${data.total > 0 ? accuracy : 0}%"></div>
          </div>
          <div class="mastery-label ${labelClass}">
            ${data.total > 0 ? accuracy.toFixed(0) + '% - ' : ''}${labelText}
          </div>
        `;
        grid.appendChild(card);
      });

      section.appendChild(grid);
      container.appendChild(section);
    }
  }

  // Fecha sidebar mobile ao clicar fora
  document.addEventListener('click', (e) => {
    const sidebar = document.getElementById('sidebar');
    const btn = document.querySelector('.mobile-menu-btn');
    if(window.innerWidth <= 900 && !sidebar.contains(e.target) && !btn.contains(e.target)) {
      sidebar.classList.remove('open');
      document.getElementById('sidebar-overlay').classList.remove('show');
    }
  });
</script>
</body>
</html>
