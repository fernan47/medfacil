<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Study Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f5f7fa; }
        .login-container { background-color: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); text-align: center; width: 100%; max-width: 400px; }
        h2 { color: #4a6fa5; margin-bottom: 20px; }
        .input-group { margin-bottom: 20px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-weight: 500; color: #166088; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px; font-size: 1rem; box-sizing: border-box; }
        .button-container { display: flex; gap: 10px; margin-top: 20px; }
        .button { flex: 1; padding: 12px; font-size: 1rem; border: none; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; font-weight: 500; }
        .button-primary { background-color: #4a6fa5; color: white; }
        .button-primary:hover { background-color: #166088; }
        .button-secondary { background-color: #f1f1f1; color: #333; }
        .button-secondary:hover { background-color: #e0e0e0; }
        #errorMessage { color: #f44336; margin-top: 15px; font-weight: 500; }
    </style>
</head>
<body>

    <div class="login-container">
        <h2>Study Tracker</h2>
        <div class="input-group">
            <label for="email">Email:</label>
            <input type="email" id="email" placeholder="seu@email.com">
        </div>
        <div class="input-group">
            <label for="password">Senha:</label>
            <input type="password" id="password" placeholder="******">
        </div>
        <div class="button-container">
            <button id="btnLogin" class="button button-primary">Entrar</button>
            <button id="btnSignup" class="button button-secondary">Criar Conta</button>
        </div>
        <p id="errorMessage"></p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script> <script>
        
    <script>
      const firebaseConfig = {
      apiKey: "AIzaSyCWNFjeLIjBgDa5v3W5vsCdJ1PGDeHE35A",
      authDomain: "meu-study-tracker.firebaseapp.com",
      databaseURL: "https://meu-study-tracker-default-rtdb.firebaseio.com",
      projectId: "meu-study-tracker",
      storageBucket: "meu-study-tracker.firebasestorage.app",
      messagingSenderId: "715609213126",
      appId: "1:715609213126:web:3e9cbe7e840ea20a1b6fc7"
    };
        
        const firebaseConfig = {
            apiKey: "...",
            authDomain: "...",
            databaseURL: "...",
            // ...cole o resto da sua configuração aqui
        };

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const errorMessage = document.getElementById('errorMessage');

        // --- Botões ---
        const btnLogin = document.getElementById('btnLogin');
        const btnSignup = document.getElementById('btnSignup');

        // --- Funções de Login e Cadastro ---

        // 1. Criar Conta
        btnSignup.addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                errorMessage.textContent = 'Por favor, preencha email e senha.';
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Conta criada e usuário logado
                    console.log('Conta criada!', userCredential.user);
                    // Não precisamos fazer nada, o 'onAuthStateChanged' abaixo vai cuidar do redirecionamento
                })
                .catch((error) => {
                    console.error(error);
                    if (error.code == 'auth/weak-password') {
                        errorMessage.textContent = 'A senha deve ter pelo menos 6 caracteres.';
                    } else if (error.code == 'auth/email-already-in-use') {
                        errorMessage.textContent = 'Este email já está em uso. Tente fazer login.';
                    } else {
                        errorMessage.textContent = 'Erro ao criar conta.';
                    }
                });
        });

        // 2. Entrar
        btnLogin.addEventListener('click', () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!email || !password) {
                errorMessage.textContent = 'Por favor, preencha email e senha.';
                return;
            }

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Usuário logado
                    console.log('Login com sucesso!', userCredential.user);
                    // O 'onAuthStateChanged' abaixo vai cuidar do redirecionamento
                })
                .catch((error) => {
                    console.error(error);
                    errorMessage.textContent = 'Email ou senha incorretos.';
                });
        });


        // --- OUVINTE PRINCIPAL DE AUTENTICAÇÃO ---
        // Este é o código mais importante. Ele roda sempre que o 
        // status de login muda (login, logout, criação de conta).
        auth.onAuthStateChanged((user) => {
            if (user) {
                // O usuário ESTÁ logado.
                console.log('Status: Logado. Redirecionando para o app...');
                // Redireciona para sua página principal do tracker.
                // MUDE 'tracker.html' para o nome da sua página principal (ex: 'index.html' antigo)
                window.location.href = 'index.html'; 
            } else {
                // O usuário NÃO está logado.
                console.log('Status: Deslogado. Aguardando na página de login.');
                errorMessage.textContent = '';
            }
        });

    </script>
</body>
</html>